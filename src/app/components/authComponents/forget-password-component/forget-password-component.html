<section class="py-28 bg-white dark:bg-slate-950 transition-colors duration-500">
    <div class="max-w-6xl mx-auto px-6">
        <div class="container mx-auto">
            <div class="flex items-center justify-center min-h-screen p-4 relative">
                
                <div class="bg-linear-to-b md:bg-linear-to-r from-white to-cyan-200 
                            dark:from-slate-900 dark:to-cyan-950 shadow-2xl rounded-4xl p-6 sm:p-10 w-full max-w-lg border dark:border-slate-800">
                    
                    <h1 class="text-3xl font-bold text-gray-800 dark:text-white mb-4">
                        @if (step === 'email') {
                            Forgot Password
                        } @else {
                            Verify Code
                        }
                    </h1>

                    @if (errorText) {
                        <div class="my-4 p-3 rounded-2xl text-center font-semibold bg-cyan-300 dark:bg-cyan-900/50 dark:text-cyan-200 shadow-xl border dark:border-cyan-800 transition-all">
                            {{ errorText }}
                        </div>
                    }

                    @if (step === 'email') {
                        <form [formGroup]="emailForm" (ngSubmit)="sendResetEmail()">
                            <div class="my-5">
                                <label for="email" class="capitalize font-bold dark:text-slate-200">Email:</label>
                                <input type="email" id="email" class="form-control dark:bg-slate-900 dark:text-white dark:border-slate-700 focus:ring-2 focus:ring-cyan-500 outline-none" 
                                    formControlName="email"
                                    [ngClass]="{
                                      'valid': !emailForm.get('email')?.errors && (emailForm.get('email')?.touched || emailForm.get('email')?.dirty),
                                      'invalid': emailForm.get('email')?.errors && (emailForm.get('email')?.touched || emailForm.get('email')?.dirty)
                                    }">

                                @if(emailForm.get('email')?.errors && emailForm.get('email')?.touched){
                                    <div class="bg-cyan-300 dark:bg-cyan-900/40 dark:text-cyan-200 text-lg p-3 rounded-2xl my-3 font-semibold shadow-2xl">
                                        @if(emailForm.get('email')?.getError('required')){<p>email must be required</p>}
                                        @else if(emailForm.get('email')?.getError('email')){<p>email format is not correct</p>}
                                    </div>
                                }
                            </div>

                            <button type="submit" [disabled]="emailForm.invalid || loading" 
                                class="w-full cursor-pointer p-3 rounded-2xl text-white font-bold transition-all shadow-2xl border-2 border-cyan-300 dark:border-cyan-800"
                                [ngClass]="{
                                    'bg-cyan-500 hover:bg-cyan-600': !emailForm.invalid && !loading,
                                    'bg-cyan-300 dark:bg-slate-800 dark:text-slate-500': emailForm.invalid || loading
                                }">
                                Send Reset Code
                                @if (loading) { <span class="ml-2"><i class="fa-solid fa-circle-notch fa-spin"></i></span> }
                            </button>
                        </form>
                    }

                    @if (step === 'code') {
                        <form [formGroup]="codeForm" (ngSubmit)="verifyCode()">
                            <p class="mb-4 text-lg text-gray-600 dark:text-slate-400">Enter the code sent to: <br> <b class="text-cyan-700 dark:text-cyan-400">{{ userEmail }}</b></p>
                            
                            <div class="my-5">
                                <label for="resetCode" class="capitalize font-bold dark:text-slate-200">Reset Code:</label>
                                <input type="text" id="resetCode" class="form-control dark:bg-slate-900 dark:text-white dark:border-slate-700" 
                                    placeholder="Enter 6 digits"
                                    formControlName="resetCode"
                                    [ngClass]="{
                                        'valid': !codeForm.get('resetCode')?.errors && (codeForm.get('resetCode')?.touched || codeForm.get('resetCode')?.dirty),
                                        'invalid': codeForm.get('resetCode')?.errors && (codeForm.get('resetCode')?.touched || codeForm.get('resetCode')?.dirty)
                                    }">

                                @if(codeForm.get('resetCode')?.errors && codeForm.get('resetCode')?.touched){
                                    <div class="bg-cyan-300 dark:bg-cyan-900/40 dark:text-cyan-200 text-lg p-3 rounded-2xl my-3 font-semibold shadow-2xl">
                                        @if(codeForm.get('resetCode')?.getError('required')){<p>reset code is required</p>}
                                        @else if(codeForm.get('resetCode')?.getError('maxlength')){<p>code must be 6 digits</p>}
                                    </div>
                                }
                            </div>

                            <button type="submit" [disabled]="codeForm.invalid || loading" 
                                class="w-full cursor-pointer p-3 rounded-2xl text-white font-bold transition-all shadow-2xl border-2 border-cyan-300 dark:border-cyan-800"
                                [ngClass]="{
                                    'bg-cyan-500 hover:bg-cyan-600': !codeForm.invalid && !loading,
                                    'bg-cyan-300 dark:bg-slate-800 dark:text-slate-500': codeForm.invalid || loading
                                }">
                                Verify and Reset Password
                                @if (loading) { <span class="ml-2"><i class="fa-solid fa-circle-notch fa-spin"></i></span> }
                            </button>
                        </form>
                    }
                </div>
            </div>
        </div>
    </div>
</section>